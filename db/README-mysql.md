## MySQL

### 简介

MySQL 是最流行的**关系型**数据库管理系统，关系型可以理解为表格

#### 关系数据库系统的特点

- 数据以表格的形式出现

- 每行为各种记录名称
- 每列为记录名称所对应的数据域
- 许多的行和列组成一张表单
- 若干的表单组成database

#### 关系数据库系统的术语

##### 主键

> 主键是唯一的

##### 外键

> 表的特殊字段。用于建立2张表的关联关系

##### 复合键

> 复合键（组合键）将多个列作为一个索引键，一般用于复合索引

##### 索引

> 索引是对数据库表中列的值进行排序的一种结构,可快速访问数据库表中的特定信息

### 逻辑架构

1. 客户端：连接处理、授权认证、安全

2. 核心服务：解析、分析、优化、缓存以及内置函数

   > 所有跨存储引擎的功能都在这一层实现：存储过程、触发器、视图等

3. 存储引擎：数据存储、提取

   > 服务层通过统一的API与存储引擎通信

#### 核心服务

- 查询缓存

  > 查询缓存将查询结果按 K-V 的形式进行缓存，K 是查询的语句
  >
  > 当一个表发生更新后，该表对应的所有缓存均会失效

  包含一些自定义函数不会进行缓存，比如now()

  query_cache_type配置

  1. 0(OFF)：关闭 Query Cache 功能，任何情况下都不会使用 Query Cache；
  2. 1(ON)：开启 Query Cache 功能，但是当SELECT语句中使用SQL_NO_CACHE提示后，将不使用Query Cache；
  3. 2(DEMAND)：开启Query Cache 功能，但是只有当SELECT语句中使用了SQL_CACHE 提示后，才使用Query Cache

  FLUSH QUERY CACHE 整理缓存碎片(每个缓存会开辟相同的内存块,结果存入内存后释放掉富余的空间)

  

- 解析器

  > 先 词法分析：对一个sql拆分,识别出各个字符串代表的含义
  >
  > 语法分析：根据定义的语法规则判断 SQL 是否满足 MySQL 语法

- 优化器

  > 获取到分析器的结果后，通过表结构和 SQL 语句选择执行方案

  多表关联时，各个表如何进行连接；当表中有索引时，应该怎样选择索引 

- 执行器

  1. 调用引擎接口取第一行，判断是否符合条件，满足存到结果集。继续下一行

  2. 上述遍历过程中所有满足条件的行组成的记录集作为结果集返回给客户端

### 事务

是一组原子性的SQL查询，或者说一个独立的工作单元

ACID表示原子性（atomicity）、一致性（consistency）、隔离性（isolation）和持久性（durability）

- 原子性

  > 一个事务必须被视为一个不可分割的最小工作单元，整个事务中的所有操作要么全部提交成功，要么全部失败回滚

- 一致性

  > 应用系统从一个正确的状态到另一个正确的状态

  正确状态其实就是满足预定的约束，比如账户金额不能为负值

  AID都是数据库的特征，一致性其实是依赖于应用层(开发者)

  ACID就是说事务能够通过AID来保证这个C的过程.C是目的,AID都是手段

- 隔离性

  > 一个事务所做的修改在最终提交以前，对其他事务是不可见的。且并发的事务互相没有影响

- 持久性

  > 事务一旦提交，它对数据库的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响

### Statement、PreparedStatement
	
	Statement是直接把sql提交到数据库
	
	PreparedStatement：吧sql语句变量抽出来
	
	> PreparedStatement继承了Statement，为了解决Statement对象多次执行同一个sql语句的效率问题
	>
	> PreparedStatement机制是在数据库支持预编译下，将sql预编译。当执行sql时，直接执行编译好的sql
	
	PreparedStatement同时也可以防止sql安全问题
	

### 链接

[一致性的解释](https://www.zhihu.com/question/31346392)

